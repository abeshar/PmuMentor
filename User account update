import java.io.*;
import java.util.Scanner;

public class UserAccountUpdate {

    // Function to update the user account information (password in this case)
    public static void updateAccount() {
        Scanner scanner = new Scanner(System.in);
        String usersDb = "users.txt";

        // Get the username
        System.out.print("Enter your username: ");
        String username = scanner.nextLine().trim();

        // Get the old password
        System.out.print("Enter your current password: ");
        String oldPassword = scanner.nextLine().trim();

        // Read the file and prepare to update the user information
        File tempFile = new File("users_temp.txt");
        boolean userFound = false;
        boolean passwordUpdated = false;

        try (BufferedReader reader = new BufferedReader(new FileReader(usersDb));
             BufferedWriter writer = new BufferedWriter(new FileWriter(tempFile))) {
            
            String line;
            while ((line = reader.readLine()) != null) {
                String[] user = line.split(",");
                // Check if the username and password match
                if (user[0].equals(username) && user[1].equals(oldPassword)) {
                    userFound = true;
                    // Allow the user to enter a new password
                    System.out.print("Enter your new password: ");
                    String newPassword = scanner.nextLine().trim();
                    // Update the password
                    user[1] = newPassword;
                    writer.write(user[0] + "," + user[1] + "\n");
                    passwordUpdated = true;
                } else {
                    // Write all other users unchanged to the temp file
                    writer.write(line + "\n");
                }
            }

            // Check if the user was found and password was updated
            if (!userFound) {
                System.out.println("Invalid username or current password. Account not found.");
            } else if (passwordUpdated) {
                System.out.println("Password updated successfully!");
            }

            // Rename temp file to the original file
            if (!tempFile.renameTo(new File(usersDb))) {
                System.out.println("Error while updating the account.");
            }

        } catch (IOException e) {
            System.out.println("Error reading or writing the users database.");
        }
    }

    public static void main(String[] args) {
        updateAccount();
    }
}
